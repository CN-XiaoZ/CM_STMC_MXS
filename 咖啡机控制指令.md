# 咖啡机控制指令

### 发送指令

> 0x12 0x34 是指令头 0x1F和0x2F是指令尾 第三位为指令内容的长度 从第四位开始到校验位前都是指令内容,倒数第三位为校验位 数值为之前所有的加起来取低两位,例如 之前的指令内容 0x12 0x34 0x01 0x01 加起来是0x48

##### 进入清洗阶段

`0x12,0x34,0x01,0x01,0x48,0x1F,0x2F` 指令内容为0x01

##### 缺料状态下填料完成（由运维人员操作上位机发出 表示已经加入料粉）

`0x12,0x34,0x01,0x02,0x49,0x1F,0x2F`

##### 进入支付阶段

`0x12,0x34,0x01,0x03,0x4A,0x1F,0x2F`

##### 进入工作阶段 传输配方编号，糖量，豆种

`0x12,0x34,0x04,0x**,0x**,0x**,0x**,0x1F,0x2F`第一个0x**是配方编号 第二个是糖量(0-9),第三个是豆种,选项是1和2 第四个是校验.

例子:`0x12,0x34,0x04,0x01,0x03,0x01,0x4B,0x1F,0x2F`配方01 糖量3分 豆种1

##### 新增配方

`0x12,0x34,0xF1,0x**,...,0x**,0x1F,0x2F`配方长度固定为240 指令内容第一位为编号 之后都是内容
例如新增9号配方就是`0x12,0x34,0xF1,0x09,...,0x**,0x1F,0x2F` ...代表240位数据 配方如果没有用满240  剩下的位数全部补0

##### 当前剩余量

`0x12,0x34,0x01,0x04,0x4A,0x1F,0x2F`两个豆仓 两个粉料 一个牛奶 三瓶糖浆 共有8个反馈

粉料和豆仓因为由红外检测量 所以没有具体量 以0-正常 1-缺料 2- 严重缺料 3-停机作为指示

牛奶和糖浆采用压力传感器 数值在0-255之间 

例子 校验位没写 懒得算了

```
0x12 0x34   0x08       0x00        0x01       0x00         0x01       0xE4
[ 指令头 ] [指令长度][豆仓1检测量][豆仓2检测量][粉料1检测量][粉料2检测量][牛奶检测量]
 0xA1   0xB2  0xC3   0x**  0x1F 0x2F
[糖浆1][糖浆2][糖浆3][校验] [ 指令尾 ]
```


### 接收反馈

##### 校验失败反馈

`0x12,0x34,0xFE,0x1F,0x2F`

##### 已经进入清洗反馈

`0x12,0x34,0x00,0x1F,0x2F`

##### 完成清洗，进入等待阶段反馈

`0x12,0x34,0x01,0x1F,0x2F`

##### 进入缺料待装填阶段反馈

`0x12,0x34,0x**,0x**,0x1F,0x2F`  第一位为料盒/牛奶盒编号 第二位为警报级别 0-警报 1- 惩罚 2-停机

##### 确认填料完成反馈

`0x12,0x34,0x03,0x1F,0x2F`

##### 确认填料未完成反馈

`0x12,0x34,0x04,0x1F,0x2F`

##### 支付超时反馈

`0x12,0x34,0x05,0x1F,0x2F`

##### 二维码内容传输

```C
0x12,0x34,\
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,\
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,\
0x00,0x00,\
0x1F,0x2F
第一行指令头 第二行第三行是数据 共18位 第四行为校验位 将二三行的加起来(不取反是怕Java麻烦)
最后一行指令尾
```

##### 工作阶段反馈 1. 磨豆机启动

`0x12,0x34,0x07,0x1F,0x2F`

##### 工作阶段反馈 2. 冲泡开始

`0x12,0x34,0x08,0x1F,0x2F`

##### 工作阶段反馈 3. 粉料加入

`0x12,0x34,0x09,0x1F,0x2F`

##### 工作阶段反馈 4. 辅料加入

`0x12,0x34,0x0A,0x1F,0x2F`

##### 工作阶段反馈 5. 完成

`0x12,0x34,0x0B,0x1F,0x2F`





