# MXS咖啡机测试版本

> Programer: ZJU-Xizo
需要的中断：EXTI9_5_IRQn,EXTI15_10_IRQn,TIM6_IRQn(用于调试系统的基准时间)，USART1_RXNE,UART5_RXNE,UART4_IRQn,TIM7_IRQn


/*
 * 指令16位 形式为A1 A2 A3 A4 字符长度 内容 两位校验码  B4 B3 B2 B1
 * 1. 等待阶段
 *    等待阶段主要是等待USART1的RXNE中断（安卓指令 清洗等命令也由安卓控制） UART5的RXNE中断（反馈系统的指令）
 *    优先级上USART1中断优先 反馈指令需要反馈系统一直发送以免漏掉
 *    阶段转换 有以下几种 指令16位
 *    1. 清洗阶段 上位机发送指令->
 *       A1 A2 A3 A4 01 00 00 01 B4 B3 B2 B1             
 *      清洗阶段（关闭所有中断 进入清洗流程）
 *      结束以后发回数据：
 *      A1 A2 A3 A4 01 01 00 02 B4 B3 B2 B1
 *      表示结束 程序返回等待阶段
 *    2. 缺料等待阶段 向上位机发送指令->
 *      A1 A2 A3 A4 01 02 00 03 B4 B3 B2 B1
 *        关闭除UART5和USART1以外的中断，等待UART5返回已经填料的信息，等待USART1返回可以开始的信息 UASRT1中断优先高
 *        都等待到后进入等待阶段 返回给上位机指令
 *      A1 A2 A3 A4 01 03 00 04 B4 B3 B2 B1
 *    3. 支付阶段  
 *      上位机发送指令
 *           A1 A2 A3 A4 01 02 00 03 B4 B3 B2 B1
 *      进入支付阶段
 * 2. 支付阶段
 *      关闭UART5中断 关闭UART1中断 打开UART4中断 打开TIM6中断，定时1S，跳60次 并开始计时
 *      两种情况 第一种TIM6计时结束仍然没有收到UART4中断，转入等待阶段，并且返回指令
 *      A1 A2 A3 A4 01 02 00 03 B4 B3 B2 B1
 *      第二种 收到了UART4信号，关闭TIM6中断，打开UART1中断,并且将UART4信息转发给USART1，等待UART1返回验证数据
 *      验证正确去工作阶段 验证不正确去等待阶段。
 * 3. 工作状态
 *      关闭UART5，UART4，USART1中断，关闭TIM6中断，打开TIM7中断 通过TIM7中断控制一下电机运转
*/